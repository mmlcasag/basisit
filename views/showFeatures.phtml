<?php
    $v_params  = $this->getParams();
    
    $registros = array();
    if (array_key_exists('registros', $v_params)) {
        $registros = $v_params['registros'];
    }
    
    $naoClassificados = 0;
    if (array_key_exists('naoClassificados', $v_params)) {
        $naoClassificados = $v_params['naoClassificados'];
    }
    
    $meusRegistros = array();
    if (array_key_exists('meusRegistros', $v_params)) {
        $meusRegistros = $v_params['meusRegistros'];
    }
    
    $resumoGeral = array();
    if (array_key_exists('resumoGeral', $v_params)) {
        $resumoGeral = $v_params['resumoGeral'];
    }
    
    $totalMeusRegistrosAtividades = 0;
    $totalMeusRegistrosChamados = 0;
    foreach($meusRegistros AS $meuRegistro) {
        $totalMeusRegistrosAtividades = $totalMeusRegistrosAtividades + $meuRegistro['situacaoQuantidadeAtividades'];
        $totalMeusRegistrosChamados = $totalMeusRegistrosChamados + $meuRegistro['situacaoQuantidadeChamados'];
    }
    
    $totalResumoGeralAtividades = 0;
    $totalResumoGeralChamados = 0;
    foreach($resumoGeral AS $resumo) {
        $totalResumoGeralAtividades = $totalResumoGeralAtividades + $resumo['usuarioQuantidadeAtividades'];
        $totalResumoGeralChamados = $totalResumoGeralChamados + $resumo['usuarioQuantidadeChamados'];
    }
?>

<?php include 'pageopen.php' ?>

<div class="container">
    
    <div class="page-header">
        <h3>Funcionalidades<small> / Tela de Listagem</small></h3>
    </div>
    
    <?php if ($_SESSION['perfilCliente'] == 1) { ?>
        <table width="100%">
            <tr>
                <td align="center" valign="top" style="padding: 5px 5px 5px 5px">
                    
                    <div class="panel panel-success">
                        <div class="panel-heading">
                            <table width="100%">
                                <tr>
                                    <td align="left"><h1><span class="glyphicon glyphicon-tasks"></h1></td>
                                    <td align="right"><b><h2><?php echo $totalMeusRegistrosChamados ?></h2>Meus Registros</b></td>
                                </tr>
                            </table>
                        </div>
                        <div class="panel-body">
                        <table class="table table-striped">

                            <thead>
                                <tr>
                                    <th class="col-sm-1 text-center">Situação</th>
                                    <th class="col-sm-1 text-center">Chamados</th>
                                </tr>
                            </thead>

                            <tbody>
                                <?php foreach($meusRegistros AS $meuRegistro) { ?>
                                <tr>
                                    <td class="text-center"><?php echo $meuRegistro['situacaoDescricao']; ?></td>
                                    <td class="text-center"><?php echo '<a href="javascript:;" onclick="listarChamadosCliente(' . $_SESSION['usuarioCodigo'] . ',' . $meuRegistro['situacaoCodigo'] . ');">' . $meuRegistro['situacaoQuantidadeChamados'] . '</a>'; ?></td>
                                </tr>
                                <?php } ?>
                            </tbody>

                        </table>
                        </div>
                    </div>
                    
                </td>
                <td align="center" valign="top" style="padding: 5px 5px 5px 5px">
                    
                    <div class="panel panel-warning">
                        <div class="panel-heading">
                            <table width="100%">
                                <tr>
                                    <td align="left"><h1><span class="glyphicon glyphicon-globe"></h1></td>
                                    <td align="right"><b><h2><?php echo $totalResumoGeralChamados ?></h2>Minha Empresa</b></td>
                                </tr>
                            </table>
                        </div>
                        <div class="panel-body">
                        <table class="table table-striped">

                            <thead>
                                <tr>
                                    <th class="col-sm-1 text-center">Usuário</th>
                                    <th class="col-sm-1 text-center">Chamados</th>
                                </tr>
                            </thead>

                            <tbody>
                                <?php foreach($resumoGeral AS $resumo) { ?>
                                <tr>
                                    <td class="text-center"><?php echo $resumo['usuarioNome']; ?></td>
                                    <td class="text-center"><?php echo '<a href="javascript:;" onclick="listarChamadosEspecialCliente(' . $resumo['usuarioCodigo'] . ', 1);">' . $resumo['usuarioQuantidadeChamados'] . '</a>'; ?></td>
                                </tr>
                                <?php } ?>
                            </tbody>

                        </table>
                        </div>
                    </div>
                    
                </td>
            </tr>
        </table>
    <?php } else { ?>
        <table width="100%">
            <tr>
                <td align="center" valign="top" style="padding: 5px 5px 5px 5px">
                    
                    <div class="panel panel-danger">
                        <div class="panel-heading">
                            <table width="100%">
                                <tr>
                                    <td align="left"><h1><span class="glyphicon glyphicon-comment"></h1></td>
                                    <td align="right"><b><h2><?php echo '<a href="javascript:;" style="color: #AA0000" onclick="listarChamadosNaoClassificados();">' . $naoClassificados . '</a>' ?></h2>Não Classificados</b></td>
                                </tr>
                            </table>
                        </div>
                        <div class="panel-body">
                            <table class="table table-striped">

                                <thead>
                                    <tr>
                                        <th class="col-sm-1 text-center">Não Classificados</th>
                                        <th class="col-sm-1 text-center">Chamados</th>
                                    </tr>
                                </thead>

                                <tbody>
                                    <tr>
                                        <td class="text-center">Quantidade</td>
                                        <td class="text-center"><?php echo '<a href="javascript:;" onclick="listarChamadosNaoClassificados();">' . $naoClassificados . '</a>'; ?></td>
                                    </tr>
                                </tbody>

                            </table>
                        </div>
                    </div>
                    
                </td>
                <td align="center" valign="top" style="padding: 5px 5px 5px 5px">
                    
                    <div class="panel panel-success">
                        <div class="panel-heading">
                            <table width="100%">
                                <tr>
                                    <td align="left"><h1><span class="glyphicon glyphicon-tasks"></h1></td>
                                    <td align="right"><b><h2><?php echo '<a href="javascript:;" style="color: #006600" onclick="listarAtividadesUsuario(' . $_SESSION['usuarioCodigo'] . ');">' . $totalMeusRegistrosAtividades . '</a>' . ' / ' . '<a href="javascript:;" style="color: #006600" onclick="listarChamadosUsuario(' . $_SESSION['usuarioCodigo'] . ');">' . $totalMeusRegistrosChamados . '</a>' ?></h2>Meus Registros</b></td>
                                </tr>
                            </table>
                        </div>
                        <div class="panel-body">
                        <table class="table table-striped">

                            <thead>
                                <tr>
                                    <th class="col-sm-1 text-center">Situação</th>
                                    <th class="col-sm-1 text-center">Atividades</th>
                                    <th class="col-sm-1 text-center">Chamados</th>
                                </tr>
                            </thead>

                            <tbody>
                                <?php foreach($meusRegistros AS $meuRegistro) { ?>
                                <tr>
                                    <td class="text-center"><?php echo $meuRegistro['situacaoDescricao']; ?></td>
                                    <td class="text-center"><?php echo '<a href="javascript:;" onclick="listarAtividades(' . $_SESSION['usuarioCodigo'] . ',' . $meuRegistro['situacaoCodigo'] . ');">' . $meuRegistro['situacaoQuantidadeAtividades'] . '</a>'; ?></td>
                                    <td class="text-center"><?php echo '<a href="javascript:;" onclick="listarChamados(' . $_SESSION['usuarioCodigo'] . ',' . $meuRegistro['situacaoCodigo'] . ');">' . $meuRegistro['situacaoQuantidadeChamados'] . '</a>'; ?></td>
                                </tr>
                                <?php } ?>
                            </tbody>

                        </table>
                        </div>
                    </div>
                    
                </td>
                <td align="center" valign="top" style="padding: 5px 5px 5px 5px">
                    
                    <div class="panel panel-warning">
                        <div class="panel-heading">
                            <table width="100%">
                                <tr>
                                    <td align="left"><h1><span class="glyphicon glyphicon-globe"></h1></td>
                                    <td align="right"><b><h2><?php echo '<a href="javascript:;" style="color: #8B7500" onclick="listarAtividadesEspecialGeral(1);">' . $totalResumoGeralAtividades . '</a>' . ' / ' . '<a href="javascript:;" style="color: #8B7500" onclick="listarChamadosEspecialGeral(1);">' . $totalResumoGeralChamados . '</a>' ?></h2>Resumo Geral</b></td>
                                </tr>
                            </table>
                        </div>
                        <div class="panel-body">
                        <table class="table table-striped">

                            <thead>
                                <tr>
                                    <th class="col-sm-1 text-center">Analista</th>
                                    <th class="col-sm-1 text-center">Atividades</th>
                                    <th class="col-sm-1 text-center">Chamados</th>
                                </tr>
                            </thead>

                            <tbody>
                                <?php foreach($resumoGeral AS $resumo) { ?>
                                <tr>
                                    <td class="text-center"><?php echo $resumo['usuarioNome']; ?></td>
                                    <td class="text-center"><?php echo '<a href="javascript:;" onclick="listarAtividadesEspecial(' . $resumo['usuarioCodigo'] . ', 1);">' . $resumo['usuarioQuantidadeAtividades'] . '</a>'; ?></td>
                                    <td class="text-center"><?php echo '<a href="javascript:;" onclick="listarChamadosEspecial(' . $resumo['usuarioCodigo'] . ', 1);">' . $resumo['usuarioQuantidadeChamados'] . '</a>'; ?></td>
                                </tr>
                                <?php } ?>
                            </tbody>

                        </table>
                        </div>
                    </div>
                    
                </td>
            </tr>
        </table>
    <?php } ?>
    
</div>

<script type="text/javascript">
    function post(controle, acao) {
        postViaJS('', {controle: controle, acao: acao});
    }
    function listarChamados(usuarioCodigo, situacaoCodigo) {
        postViaJS('', {controle: 'Chamados', acao: 'listar', atendente: usuarioCodigo, situacao: situacaoCodigo}, "post", "_blank");
    }
    function listarChamadosUsuario(usuarioCodigo) {
        postViaJS('', {controle: 'Chamados', acao: 'listar', atendente: usuarioCodigo}, "post", "_blank");
    }
    function listarChamadosCliente(usuarioCodigo, situacaoCodigo) {
        postViaJS('', {controle: 'Chamados', acao: 'listar', usuario: usuarioCodigo, situacao: situacaoCodigo}, "post", "_blank");
    }
    function listarAtividades(usuarioCodigo, situacaoCodigo) {
        postViaJS('', {controle: 'Atividades', acao: 'listar', usuario: usuarioCodigo, situacao: situacaoCodigo}, "post", "_blank");
    }
    function listarAtividadesUsuario(usuarioCodigo) {
        postViaJS('', {controle: 'Atividades', acao: 'listar', usuario: usuarioCodigo}, "post", "_blank");
    }
    function listarChamadosEspecial(usuarioCodigo, especial) {
        postViaJS('', {controle: 'Chamados', acao: 'listar', atendente: usuarioCodigo, especial: especial}, "post", "_blank");
    }
    function listarChamadosEspecialGeral(especial) {
        postViaJS('', {controle: 'Chamados', acao: 'listar', especial: especial, especialCliente: 1}, "post", "_blank");
    }
    function listarChamadosEspecialCliente(usuarioCodigo, especial) {
        postViaJS('', {controle: 'Chamados', acao: 'listar', usuario: usuarioCodigo, especial: especial}, "post", "_blank");
    }
    function listarAtividadesEspecial(usuarioCodigo, especial) {
        postViaJS('', {controle: 'Atividades', acao: 'listar', usuario: usuarioCodigo, especial: especial}, "post", "_blank");
    }
    function listarAtividadesEspecialGeral(especial) {
        postViaJS('', {controle: 'Atividades', acao: 'listar', especial: especial, especialCliente: 1}, "post", "_blank");
    }
    function listarChamadosNaoClassificados() {
        postViaJS('', {controle: 'Chamados', acao: 'listarNaoClassificados'}, "post", "_blank");
    }
</script>

<?php include 'pageclose.php';